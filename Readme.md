# Drivee Calcualtor Model
Простой сервис для расчёта справедливой цены и рекомендаций по цене поездки на такси с учётом множества факторов.

### Используемые технологии
- Python 3.10
- FastAPI
- NumPy / Pandas
- scikit-learn
- Docker


## 1. Описание проекта
    Проект позволяет:
        - Рассчитать справедливую цену (fair_price) поездки.
        - Дать рекомендации по ценам:
        - safe_price — безопасная цена с высокой вероятностью согласия водителя.
        - optimal_price — оптимальная цена для максимального ожидаемого дохода.
        - risky_price — цена с низкой вероятностью согласия, но потенциально высокой доходностью.
        - Учитывает факторы поездки:
        - Расстояние и время поездки 
        - Расстояние и время до точки посадки
        - Рейтинг и опыт водителя
        - Наличие питомцев и багажа
        - Срочность и трафик
        - Погодные условия и температуру
        - Время дня, день недели, сезон и праздники
        - Количество пассажиров

## 2. Как запустить проект
  1. Через Docker Hub <br />
    Сервис уже упакован в Docker image: senkyz/model. <br />
    Скачайте и запустите контейнер: docker run -d -p 8000:8000 senkyz/model<br />
    API будет доступен по адресу: http://127.0.0.1:8000

## 3. Эндпоинты

**POST /fair_price**

Рассчитывает справедливую цену и варианты со скидкой.

**Пример запроса:**
```json
{
  "distance_in_meters": 12000,
  "pickup_in_meters": 500,
  "pickup_in_seconds": 300,
  "driver_rating": 4.8,
  "driver_experience_days": 900,
  "price_start_local": 250,
  "has_pet": true,
  "has_baggage": true,
  "urgent": true,
  "traffic_jam": true,
  "weather": "snow",
  "holiday": true,
  "temperature": -5,
  "season": "winter",
  "passengers": 5
}
```
**Пример ответа:**
```json
{
    "fair_price": {
        "fair_price": 1427.43,
        "discount_10": 1284.69,
        "discount_15": 1213.32,
        "discount_20": 1141.94
    }
}
```

**POST /recommend**

Рекомендует оптимальную цену на основе параметров поездки, учитывая справедливую стоимость, рыночные факторы и ожидаемый доход.

**Пример запроса:**
```json 
{
  "distance_in_meters": 12000,
  "pickup_in_meters": 500,
  "pickup_in_seconds": 300,
  "driver_rating": 4.8,
  "driver_experience_days": 900,
  "price_start_local": 250,
  "has_pet": true,
  "has_baggage": true,
  "urgent": true,
  "traffic_jam": true,
  "weather": "snow",
  "holiday": true,
  "temperature": -5,
  "season": "winter",
  "passengers": 5
}
```
**Пример ответа:**
```json
{
  "safe_price": 1404.89,
  "optimal_price": 1449.97,
  "risky_price": 999.2,
  "expected_income": 1427.07
}
```

### Параметры входных данных

| Параметр                 | Тип   | Описание                                           |
| ------------------------ | ----- | -------------------------------------------------- |
| `distance_in_meters`     | int   | Расстояние поездки в метрах                        |
| `pickup_in_meters`       | int   | Расстояние до клиента в метрах                     |
| `pickup_in_seconds`      | int   | Время до клиента в секундах                        |
| `driver_rating`          | float | Рейтинг водителя                                   |
| `driver_experience_days` | int   | Опыт водителя в днях                               |
| `price_start_local`      | float | Начальная цена                                     |
| `has_pet`                | bool  | Есть ли питомец                                    |
| `has_baggage`            | bool  | Есть ли багаж                                      |
| `urgent`                 | bool  | Срочность поездки                                  |
| `traffic_jam`            | bool  | Пробка на маршруте                                 |
| `weather`                | str   | Погода: `clear`, `rain`, `snow`, `storm`           |
| `holiday`                | bool  | Праздничный день                                   |
| `temperature`            | float | Температура воздуха                                |
| `season`                 | str   | Время года: `winter`, `spring`, `summer`, `autumn` |
| `passengers`             | int   | Количество пассажиров                              |

### Структура проекта

| Файл                   | Описание                                                                                                                                                                                                                                  |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **api_server.py**      | Основной сервер приложения на FastAPI. Обрабатывает запросы `/fair_price` и `/recommend`, вызывает функции расчёта из `recommend_logic.py` и возвращает результаты в формате JSON.                                                        |
| **prepare_data.py**    | Подготавливает и нормализует входные данные — приводит значения к нужным диапазонам, кодирует категориальные признаки (погода, сезон и т. д.), чтобы модель могла их корректно использовать.                                              |
| **train_model.py**     | Отвечает за обучение и сохранение модели (например, регрессии). Используется на этапе разработки или обновления логики расчёта цен. Может генерировать веса, которые потом применяются в `recommend_logic.py`.                            |
| **recommend_logic.py** | Основной модуль бизнес-логики. Содержит функции расчёта справедливой цены (`fair_price`) и генерации рекомендаций по ценам (`safe`, `optimal`, `risky`) с учётом множества факторов — погоды, времени, опыта водителя, срочности, и т. д. |


